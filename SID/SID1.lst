Sjasm Z80 Assembler v0.42c - www.xl2s.tk             [2021.02.13 - 20:47:01]

SID1.ASM
Errors: 0

       1   00:0200                      ; RC2014 SID TESTER
       2   00:0200                      ; Ported from the code in SID2.BAS
       3   00:0200                      
       4   00:0200                                  ORG		$0200
       5   00:0200                      
       6   00:0200  CD E3 02            	        CALL	CLEAR_SID
       7   00:0203  1E 00               			LD		E, 0
       8   00:0205                      
       9   00:0205  3E 00               			LD		A, 0x00			; VOICES 1, 2 & 3 == 0x00, 0x07, 0x0E
      10   00:0207  32 D3 02            			LD		(VOICE), A
      11   00:020A                      
      12   00:020A  16 0F               SETUP:		LD		D, 0x0F		
      13   00:020C  3E 18               			LD		A, 0x18
      14   00:020E  1E 00               			LD		E, 0
      15   00:0210  CD D5 02            			CALL	SID_IO			; 450 R = 24 : D = 15 : GOSUB 1000	
      16   00:0213                      
      17   00:0213  3A D3 02            			LD		A, (VOICE)
      18   00:0216  67                  			LD		H, A
      19   00:0217  16 61               			LD		D, 0x61		
      20   00:0219  3E 05               			LD		A, 0x05
      21   00:021B  84                  			ADD		H
      22   00:021C  1E 00               			LD		E, 0
      23   00:021E  CD D5 02            			CALL	SID_IO			; 451 R = 5 + V : D = 97 : GOSUB 1000
      24   00:0221                      
      25   00:0221  3A D3 02            			LD		A, (VOICE)
      26   00:0224  67                  			LD		H, A
      27   00:0225  16 C8               			LD		D, 0xC8		
      28   00:0227  3E 06               			LD		A, 0x06
      29   00:0229  84                  			ADD		H
      30   00:022A  1E 00               			LD		E, 0
      31   00:022C  CD D5 02            			CALL	SID_IO			;452 R = 6 + V : D = 200 : GOSUB 1000
      32   00:022F                      
      33   00:022F  CD 0C 03            			CALL	RND
      34   00:0232  7D                  			LD		A, L
      35   00:0233  E6 03               			AND		0x03
      36   00:0235  FE 00               OPTION1:	CP		0x00
      37   00:0237  C2 3F 02            			JP		NZ, OPTION2		
      38   00:023A  16 21               			LD		D, 0x21
      39   00:023C  C3 55 02            			JP		NEXT
      40   00:023F  FE 01               OPTION2:	CP		0x01
      41   00:0241  C2 49 02            			JP		NZ, OPTION3
      42   00:0244  16 41               			LD		D, 0x41
      43   00:0246  C3 55 02            			JP		NEXT
      44   00:0249  FE 02               OPTION3:	CP		0x02
      45   00:024B  C2 53 02            			JP		NZ, OPTION4
      46   00:024E  16 81               			LD		D, 0x81
      47   00:0250  C3 55 02            			JP		NEXT
      48   00:0253  16 11               OPTION4:	LD		D, 0x11
      49   00:0255  3A D3 02            NEXT:		LD		A, (VOICE)
      50   00:0258  67                  			LD		H, A
      51   00:0259  3E 04               			LD		A, 0x04
      52   00:025B  84                  			ADD		H
      53   00:025C  1E 00               			LD		E, 0
      54   00:025E  CD D5 02            			CALL	SID_IO			; 453 R = 4 + V : D = W : GOSUB 1000
      55   00:0261                      
      56   00:0261  3E 00               			LD		A, 0x0			; 460 FOR X = 0 TO 255 STEP INT((RND(1)*15)+1)
      57   00:0263  32 D2 02            			LD		(VX), A
      58   00:0266                      
      59   00:0266  CD 0C 03            			CALL	RND
      60   00:0269  7D                  			LD		A, L
      61   00:026A  E6 0F               			AND     0x0F
      62   00:026C  3C                  			INC		A
      63   00:026D  32 D4 02            			LD		(STEP), A
      64   00:0270                      
      65   00:0270  3A D3 02            XLOOP:		LD		A, (VOICE)
      66   00:0273  67                  			LD		H, A
      67   00:0274  3A D2 02            			LD		A, (VX)
      68   00:0277  57                  			LD		D, A		
      69   00:0278  3E 00               			LD		A, 0x00
      70   00:027A  84                  			ADD		H
      71   00:027B  1E 00               			LD		E, 0
      72   00:027D  CD D5 02            			CALL	SID_IO			; 470 R = 0 + V : D = X : GOSUB 1000
      73   00:0280                      
      74   00:0280  3A D3 02            			LD		A, (VOICE)
      75   00:0283  67                  			LD		H, A
      76   00:0284  3A D2 02            			LD		A, (VX)
      77   00:0287  57                  			LD		D, A
      78   00:0288  3E FF               			LD		A, 0xFF
      79   00:028A  92                  			SUB		D
      80   00:028B  57                  			LD		D, A
      81   00:028C  3E 01               			LD		A, 0x01
      82   00:028E  84                  			ADD		H
      83   00:028F  1E 00               			LD		E, 0
      84   00:0291  CD D5 02            			CALL	SID_IO			; 471 R = 1 + V : D = 255 - X : GOSUB 1000
      85   00:0294                      
      86   00:0294  CD F9 02            			CALL	DELAY
      87   00:0297                      
      88   00:0297  3E 00               			LD		A, 0			; 480 FOR Y = 0 TO 33...
      89   00:0299  3C                  YLOOP:		INC		A
      90   00:029A  FE 21               			CP		0x21
      91   00:029C  CA A2 02            			JP		Z, YLOOPXIT
      92   00:029F  C3 99 02            			JP		YLOOP
      93   00:02A2                      
      94   00:02A2  3A D4 02            YLOOPXIT:	LD		A, (STEP)
      95   00:02A5  47                  			LD		B, A
      96   00:02A6  3A D2 02            			LD		A, (VX)
      97   00:02A9  80                  			ADD		B
      98   00:02AA  DA B5 02            			JP		C, XLOOPXIT
      99   00:02AD  32 D2 02            			LD		(VX), A
     100   00:02B0  C3 70 02            			JP		XLOOP			;  ...: NEXT Y, X
     101   00:02B3                      
     102   00:02B3  3E 00               			LD		A, 0			; 490 FOR X = 0 TO 200: NEXT...
     103   00:02B5  3C                  XLOOPXIT:	INC		A
     104   00:02B6  FE C8               			CP		0xC8
     105   00:02B8  CA C9 02            			JP		Z, LSTLPXIT
     106   00:02BB  C3 B5 02            			JP		XLOOPXIT
     107   00:02BE                      
     108   00:02BE  16 00               			LD		D, 0x00	
     109   00:02C0  3E 18               			LD		A, 0x18
     110   00:02C2  1E 00               			LD		E, 0
     111   00:02C4  CD D5 02            			CALL	SID_IO			; ... : R = 24 : D = 0 :  GOSUB 1000
     112   00:02C7                      
     113   00:02C7  3E 00               			LD		A, 0			; 500 FOR X = 0 TO 100: NEXT : GOTO 410
     114   00:02C9  3C                  LSTLPXIT:	INC		A
     115   00:02CA  FE 64               			CP		0x64
     116   00:02CC  CA 0A 02            			JP		Z, SETUP
     117   00:02CF  C3 C9 02            			JP		LSTLPXIT
     118   00:02D2                      
     119   00:02D2  00                  VX			DB		0
     120   00:02D3  00                  VOICE		DB		0
     121   00:02D4  00                  STEP		DB		0
     122   00:02D5                      
     123   00:02D5                      ; ENTER WITH:	A = SID REGISTER (0x00 - 0x18)
     124   00:02D5                      ;				D = DATA BYTE
     125   00:02D5                      ;				E = INTERRUPT CONTROLLER MODE - BITS 5/6
     126   00:02D5                      ; (0x00 = OFF,  0x20 = '50Hz',  0x40 = '60Hz'  0x60 = '100Hz')
     127   00:02D5  0E 54               SID_IO:		LD		C, 0x54		; BASE I/O ADDRESS
     128   00:02D7  B3                  			OR		E
     129   00:02D8  47                  			LD		B, A
     130   00:02D9  ED 51               			OUT		(C), D		; WRITE TO SID.  /CS=0 (B BIT 7)
     131   00:02DB  00                  			NOP
     132   00:02DC  00                  			NOP					; DELAY
     133   00:02DD  00                  			NOP
     134   00:02DE  CB F8               			SET		7, B		; /CS=1 (B BIT 7)
     135   00:02E0  ED 51               			OUT		(C), D		; WRITE TO SID
     136   00:02E2  C9                  			RET
     137   00:02E3                      
     138   00:02E3  0E 54               CLEAR_SID:	LD		C, 0x54		; BASE I/O ADDRESS
     139   00:02E5  06 98               			LD		B, 0x98		; SID REGISTER 0x18, /CS =1 (BIT 7)
     140   00:02E7                      								; INTERRUPT CONTROLLER OFF
     141   00:02E7  AF                  			XOR		A			; OPTIMIZED "LD A, 0" (VOLUME 0)
     142   00:02E8  ED 79               			OUT		(C), A		; FIRSTY OUT TO ENSURE /CS HIGH
     143   00:02EA  00                  			NOP
     144   00:02EB  00                  			NOP					; DELAY
     145   00:02EC  00                  			NOP
     146   00:02ED  CB B8               			RES		7, B		; /CS=0 (B BIT 7)
     147   00:02EF  ED 79               			OUT		(C), A		; WRITE TO SID
     148   00:02F1  00                  			NOP
     149   00:02F2  00                  			NOP					; DELAY
     150   00:02F3  00                  			NOP
     151   00:02F4  CB F8               			SET		7, B		; /CS=1 (B BIT 7)
     152   00:02F6  ED 79               			OUT		(C), A		; WRITE TO SID
     153   00:02F8  C9                  			RET		
     154   00:02F9                      
     155   00:02F9  06 60               DELAY:		LD		B, 0x60
     156   00:02FB  0E FF               DELAYOUT:	LD		C, 0xFF
     157   00:02FD  0D                  DELAYIN:	DEC		C
     158   00:02FE  79                  			LD		A, C
     159   00:02FF  FE 00               			CP		0x00
     160   00:0301  C2 FD 02            			JP		NZ, DELAYIN
     161   00:0304  05                  			DEC		B
     162   00:0305  78                  			LD		A, B
     163   00:0306  FE 00               			CP		0x00
     164   00:0308  C2 FB 02            			JP		NZ, DELAYOUT
     165   00:030B  C9                  			RET
     166   00:030C                      
     167   00:030C                      
     168   00:030C                      ; 8-bit Xor-Shift random number generator.
     169   00:030C                      ; Created by Patrik Rak in 2008 and revised in 2011/2012.
     170   00:030C                      ; See http://www.worldofspectrum.org/forums/showthread.php?t=23070
     171   00:030C  21 80 A2            RND:		LD		HL,0XA280   ; YW -> ZT
     172   00:030F  11 DE C0            			LD		DE,0XC0DE   ; XZ -> YW
     173   00:0312  22 10 03            			LD		(RND+4),HL  ; X = Y, Z = W
     174   00:0315  7D                  			LD		A,L         ; W = W ^ ( W << 3 )
     175   00:0316  87                  			ADD		A,A
     176   00:0317  87                  			ADD		A,A
     177   00:0318  87                  			ADD		A,A
     178   00:0319  AD                  			XOR		L
     179   00:031A  6F                  			LD		L,A
     180   00:031B  7A                  			LD		A,D         ; T = X ^ (X << 1)
     181   00:031C  87                  			ADD		A,A
     182   00:031D  AA                  			XOR		D
     183   00:031E  67                  			LD		H,A
     184   00:031F  1F                  			RRA					; T = T ^ (T >> 1) ^ W
     185   00:0320  AC                  			XOR		H
     186   00:0321  AD                  			XOR		L
     187   00:0322  63                  			LD		H,E         ; Y = Z
     188   00:0323  6F                  			LD		L,A         ; W = T
     189   00:0324  22 0D 03            			LD		(RND+1),HL
     190   00:0327  C9                  			RET 

    LABELS
-------------------------------------------------
00:0000020A   SETUP
00:00000235 X OPTION1
00:0000023F   OPTION2
00:00000249   OPTION3
00:00000253   OPTION4
00:00000255   NEXT
00:00000270   XLOOP
00:00000299   YLOOP
00:000002A2   YLOOPXIT
00:000002B5   XLOOPXIT
00:000002C9   LSTLPXIT
00:000002D2   VX
00:000002D3   VOICE
00:000002D4   STEP
00:000002D5   SID_IO
00:000002E3   CLEAR_SID
00:000002F9   DELAY
00:000002FB   DELAYOUT
00:000002FD   DELAYIN
00:0000030C   RND


 Output: SID1.OUT
-------------------------------------------------

 Page: 00
  Org: 00000200  Size: *  Used: 00000128

   Address   Length Align   Label
   00000200     296         SETUP
